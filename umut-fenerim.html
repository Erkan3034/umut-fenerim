<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026: Umut Fenerleri</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='0%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23fbbf24;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23f59e0b;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='100' height='100' fill='%23020617'/%3E%3Cpath d='M 50 20 Q 30 20, 30 40 L 30 70 Q 30 80, 40 80 L 60 80 Q 70 80, 70 70 L 70 40 Q 70 20, 50 20 Z' fill='url(%23grad)'/%3E%3Ccircle cx='50' cy='50' r='8' fill='%23fff' opacity='0.9'/%3E%3Cpath d='M 50 20 L 50 10' stroke='%23fbbf24' stroke-width='3' stroke-linecap='round'/%3E%3C/svg%3E">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="">
    <meta property="og:title" content="2026: Umut Fenerleri - Yeni Yƒ±l Niyet Kartƒ±">
    <meta property="og:description" content="2025'in y√ºklerini bƒ±rak, 2026 i√ßin umudunu g√∂ky√ºz√ºne g√∂nder. Ki≈üisel niyet kartƒ±nƒ± olu≈ütur ve payla≈ü.">
    <meta property="og:image" content="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='1200' height='630' viewBox='0 0 1200 630'%3E%3Cdefs%3E%3ClinearGradient id='bgGrad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%231e1b4b;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23020617;stop-opacity:1' /%3E/linearGradient%3E%3ClinearGradient id='lanternGrad' x1='0%25' y1='0%25' x2='0%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23fffbeb;stop-opacity:1' /%3E%3Cstop offset='40%25' style='stop-color:%23fbbf24;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%2392400e;stop-opacity:1' /%3E/linearGradient%3E%3C/defs%3E%3Crect width='1200' height='630' fill='url(%23bgGrad)'/%3E%3Cg transform='translate(600, 200)'%3E%3Cpath d='M 0 -80 Q -40 -80, -40 -40 L -40 40 Q -40 80, 0 80 L 0 80 Q 40 80, 40 40 L 40 -40 Q 40 -80, 0 -80 Z' fill='url(%23lanternGrad)'/%3E%3Ccircle cx='0' cy='0' r='25' fill='%23fff' opacity='0.9'/%3E%3Cpath d='M 0 -80 L 0 -100' stroke='%23fbbf24' stroke-width='8' stroke-linecap='round'/%3E%3C/g%3E%3Ctext x='600' y='400' font-family='serif' font-size='48' fill='%23fbbf24' text-anchor='middle' font-weight='bold'%3E2026: Umut Fenerleri%3C/text%3E%3Ctext x='600' y='450' font-family='sans-serif' font-size='24' fill='%23fff' text-anchor='middle' opacity='0.8'%3EYeni Yƒ±l Niyet Kartƒ±%3C/text%3E%3C/svg%3E">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="2026: Umut Fenerleri - Yeni Yƒ±l Niyet Kartƒ±">
    <meta name="twitter:description" content="2025'in y√ºklerini bƒ±rak, 2026 i√ßin umudunu g√∂ky√ºz√ºne g√∂nder. Ki≈üisel niyet kartƒ±nƒ± olu≈ütur ve payla≈ü.">
    <meta name="twitter:image" content="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='1200' height='630' viewBox='0 0 1200 630'%3E%3Cdefs%3E%3ClinearGradient id='bgGrad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%231e1b4b;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23020617;stop-opacity:1' /%3E/linearGradient%3E%3ClinearGradient id='lanternGrad' x1='0%25' y1='0%25' x2='0%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23fffbeb;stop-opacity:1' /%3E%3Cstop offset='40%25' style='stop-color:%23fbbf24;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%2392400e;stop-opacity:1' /%3E/linearGradient%3E%3C/defs%3E%3Crect width='1200' height='630' fill='url(%23bgGrad)'/%3E%3Cg transform='translate(600, 200)'%3E%3Cpath d='M 0 -80 Q -40 -80, -40 -40 L -40 40 Q -40 80, 0 80 L 0 80 Q 40 80, 40 40 L 40 -40 Q 40 -80, 0 -80 Z' fill='url(%23lanternGrad)'/%3E%3Ccircle cx='0' cy='0' r='25' fill='%23fff' opacity='0.9'/%3E%3Cpath d='M 0 -80 L 0 -100' stroke='%23fbbf24' stroke-width='8' stroke-linecap='round'/%3E%3C/g%3E%3Ctext x='600' y='400' font-family='serif' font-size='48' fill='%23fbbf24' text-anchor='middle' font-weight='bold'%3E2026: Umut Fenerleri%3C/text%3E%3Ctext x='600' y='450' font-family='sans-serif' font-size='24' fill='%23fff' text-anchor='middle' opacity='0.8'%3EYeni Yƒ±l Niyet Kartƒ±%3C/text%3E%3C/svg%3E">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;0,700;1,400&family=Montserrat:wght@100;200;300;400&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #020617;
            color: #fff;
            overflow: hidden;
            touch-action: manipulation;
        }
        
        h1, h2, h3, .serif { font-family: 'Cormorant Garamond', serif; }

        .bg-ambient {
            background: radial-gradient(circle at center bottom, #1e1b4b 0%, #020617 100%);
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -2;
        }

        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        #sky-canvas { z-index: 1; }
        #lanterns-canvas { z-index: 5; }
        #particles-canvas { z-index: 10; pointer-events: none; }

        .glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }

        .emotion-input {
            background: transparent; border: none;
            border-bottom: 1px solid rgba(255,255,255,0.3);
            text-align: center; color: #fff; font-size: 1.5rem;
            width: 100%; padding: 10px; outline: none;
            transition: all 0.3s ease;
            font-family: 'Cormorant Garamond', serif; font-style: italic;
        }
        .emotion-input:focus { border-bottom: 1px solid #fbbf24; }

        .btn-glow {
            box-shadow: 0 0 15px rgba(251, 191, 36, 0.2);
            transition: all 0.5s ease;
        }
        .btn-glow:hover {
            box-shadow: 0 0 40px rgba(251, 191, 36, 0.8);
            transform: scale(1.05);
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.8s ease-out forwards; }

        #flash-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 50; pointer-events: none;
            opacity: 0; transition: opacity 2s ease-out;
        }
        .flash-active { opacity: 1 !important; transition: none !important; }

        /* Gender Selection Cards */
        .gender-card {
            border: 1px solid rgba(255,255,255,0.1);
            background: rgba(255,255,255,0.05);
            padding: 20px; border-radius: 12px; cursor: pointer;
            transition: all 0.3s;
        }
        .gender-card:hover { background: rgba(255,255,255,0.15); transform: translateY(-3px); border-color: rgba(251,191,36,0.5); }
        .gender-card.selected { border-color: #fbbf24; background: rgba(251,191,36,0.1); }

        /* Color Dot */
        .color-dot {
            width: 30px; height: 30px; border-radius: 50%; cursor: pointer;
            border: 2px solid transparent; transition: transform 0.2s;
        }
        .color-dot:hover { transform: scale(1.2); }
        .color-dot.selected { border-color: white; transform: scale(1.2); box-shadow: 0 0 10px rgba(255,255,255,0.5); }

        /* Music Control */
        #music-control {
            position: fixed; top: 20px; right: 20px; z-index: 100;
            background: rgba(255,255,255,0.1); backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.2); width: 40px; height: 40px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s;
        }
        .music-bar { width: 3px; background: #fff; margin: 0 1px; animation: equalizer 1s infinite ease-in-out; }
        .paused .music-bar { animation: none; height: 3px !important; }
        @keyframes equalizer { 0%, 100% { height: 8px; } 50% { height: 16px; } }

        /* Custom Scrollbar Hide */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* SVG Background */
        #card-bg-svg svg {
            width: 100%;
            height: 100%;
            display: block;
        }

        /* Card Word - Mobil Responsive */
        #card-word {
            word-wrap: break-word;
            word-break: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
            max-width: 100%;
            padding: 0 8px;
        }
        
        @media (max-width: 640px) {
            #card-word {
                font-size: 2.5rem !important;
                line-height: 1.2 !important;
                padding: 0 4px;
            }
        }
        
        @media (max-width: 380px) {
            #card-word {
                font-size: 2rem !important;
                line-height: 1.3 !important;
            }
        }

        /* Footer */
        footer {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 30;
            padding: 12px 24px;
            text-align: center;
            width: fit-content;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 50px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
        }
        footer a {
            color: #fbbf24;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        footer a:hover {
            color: #fcd34d;
            text-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
        }

    </style>
</head>
<body class="h-screen w-screen flex flex-col items-center justify-center relative">

    <div class="bg-ambient"></div>
    <canvas id="sky-canvas"></canvas>
    <canvas id="lanterns-canvas"></canvas>
    <canvas id="particles-canvas"></canvas>
    <div id="flash-overlay"></div>

    <!-- AUDIO -->
    <audio id="bg-music" autoplay loop preload="auto" muted>
        <source src="music.mp3" type="audio/mp3">
    </audio>
    <audio id="sfx-burst" preload="auto" src="magic.wav"></audio>
    <audio id="sfx-chime" preload="auto" src="magic.wav"></audio>

    <button id="music-control" class="paused" onclick="forcePlayMusic()">
        <div class="music-bar" style="animation-delay: 0s"></div>
        <div class="music-bar" style="animation-delay: 0.2s"></div>
        <div class="music-bar" style="animation-delay: 0.4s"></div>
    </button>

    <main id="app-container" class="relative z-20 w-full max-w-md px-6 flex flex-col items-center text-center">
        
        <!-- STEP 0: NAME -->
        <div id="step-0" class="glass p-8 rounded-2xl w-full fade-in">
            <p class="text-xs tracking-[0.3em] text-gray-400 uppercase mb-4">Yeni Yƒ±l Yolculuƒüu Ba≈ülƒ±yor</p>
            <h1 class="text-3xl md:text-4xl mb-6 font-light leading-tight">
                Sana nasƒ±l hitap<br>edelim?
            </h1>
            <input type="text" id="input-name" class="emotion-input mb-8" placeholder="Adƒ±n..." autocomplete="off">
            <button onclick="submitName()" class="w-full bg-white/10 hover:bg-white/20 text-white border border-white/20 py-4 rounded-full uppercase tracking-widest text-sm transition-all duration-300">
                Devam Et
            </button>
        </div>

        <!-- STEP 0.5: GENDER (For Card Design) -->
        <div id="step-gender" class="glass p-8 rounded-2xl w-full hidden">
            <p class="text-xs tracking-[0.3em] text-gray-400 uppercase mb-6">Kartƒ±n sana √∂zel olsun</p>
            <h1 class="text-2xl md:text-3xl mb-8 font-light">
                Cinsiyetini Se√ß
            </h1>
            
            <div class="grid grid-cols-2 gap-4 mb-8">
                <div class="gender-card" onclick="selectGender('female')">
                    <div class="text-3xl mb-2">üôÜüèª‚Äç‚ôÄÔ∏è</div>
                    <div class="text-xs uppercase tracking-widest">Kadƒ±n</div>
                </div>
                <div class="gender-card" onclick="selectGender('male')">
                    <div class="text-3xl mb-2">üôãüèª‚Äç‚ôÇÔ∏è</div>
                    <div class="text-xs uppercase tracking-widest">Erkek</div>
                </div>
            </div>
            <!-- Gizli input tutucu -->
            <input type="hidden" id="selected-gender">
        </div>

        <!-- STEP 1: RELEASE -->
        <div id="step-1" class="glass p-8 rounded-2xl w-full hidden">
            <p class="text-xs tracking-[0.3em] text-gray-400 uppercase mb-4">Adƒ±m 1: Arƒ±nma</p>
            <h1 class="text-3xl md:text-4xl mb-6 font-light leading-tight">
                2025'te seni en √ßok √ºzen,<br><span class="text-gray-500 italic">geride bƒ±rakmak</span> istediƒüin ≈üey ne?
            </h1>
            <input type="text" id="input-burden" class="emotion-input mb-8" placeholder="√ñrn: Endi≈üe, Kƒ±rgƒ±nlƒ±k..." autocomplete="off">
            <button onclick="releaseBurden()" class="w-full bg-white/10 hover:bg-white/20 text-white border border-white/20 py-4 rounded-full  tracking-widest text-sm transition-all duration-300">
                Bƒ±rak Gitsin...
            </button>
        </div>

        <!-- STEP 2: WISH -->
        <div id="step-2" class="glass p-8 rounded-2xl w-full hidden">
            <p class="text-xs tracking-[0.3em] text-yellow-500 uppercase mb-4">Adƒ±m 2: Aydƒ±nlanma</p>
            <h1 class="text-3xl md:text-4xl mb-2 font-light text-yellow-100">
                2026  i√ßin<br>dileƒüini tut ve hisset...
            </h1>
            <input type="text" id="input-wish" class="emotion-input mb-6 text-yellow-300" placeholder="√ñrn: Umut, A≈ük, Ba≈üarƒ±..." autocomplete="off">
            
            <div class="mb-8">
                <p class="text-[10px] text-gray-400 uppercase tracking-widest mb-3">Ruhunun Rengini Se√ß</p>
                <div class="flex justify-center gap-4">
                    <div class="color-dot selected" onclick="selectColor(this, '#fbbf24', '#fffbeb')" style="background: #fbbf24;"></div>
                    <div class="color-dot" onclick="selectColor(this, '#f43f5e', '#ffe4e6')" style="background: #f43f5e;"></div>
                    <div class="color-dot" onclick="selectColor(this, '#3b82f6', '#dbeafe')" style="background: #3b82f6;"></div>
                    <div class="color-dot" onclick="selectColor(this, '#10b981', '#d1fae5')" style="background: #10b981;"></div>
                </div>
            </div>
            <button onclick="launchLantern()" class="btn-glow w-full bg-gradient-to-r from-amber-600 to-amber-500 text-black font-bold py-4 rounded-full  tracking-widest text-sm">
                Feneri G√∂ky√ºz√ºne G√∂nder ‚ú®
            </button>
        </div>

        <!-- STEP 3: OBSERVE -->
        <div id="step-3" class="hidden absolute top-0 left-0 w-full h-full flex flex-col items-center justify-end pb-24 pointer-events-none">
            <div class="text-center pointer-events-auto fade-in transition-opacity duration-1000" id="observing-ui">
                <h2 class="text-5xl serif text-amber-100 glow-text mb-2 drop-shadow-lg" id="display-wish"></h2>
                <p class="text-amber-200/60 text-xs tracking-[0.3em] uppercase" id="status-text">Senin I≈üƒ±ƒüƒ±n Y√ºkseliyor</p>
            </div>
            <button onclick="showFinalCard()" id="finish-btn" class="pointer-events-auto mt-8 opacity-0 transition-opacity duration-1000 text-xs text-white/50 hover:text-white border-b border-white/30 pb-1">
                Mesajƒ± G√∂r
            </button>
        </div>

        <!-- STEP 4: SHARE CARD PREVIEW -->
        <div id="step-4" class="hidden w-full flex flex-col items-center fade-in">
            
            <!-- CAPTURE AREA: Instagram Story Boyutu (9:16 Ratio Yakla≈üƒ±k) -->
            <div id="capture-area" class="relative overflow-hidden mx-auto w-[320px] h-[568px] flex flex-col items-center text-center shadow-2xl border border-white/10" style="background-color: #000;">
                
                <!-- DYNAMIC BACKGROUND SVG -->
                <div id="card-bg-svg" class="absolute top-0 left-0 w-full h-full opacity-60"></div>
                
                <!-- Overlay Gradient for Readability -->
                <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-b from-black/30 via-black/10 to-black/80"></div>
                
                <!-- Content -->
                <div class="relative z-10 w-full h-full flex flex-col justify-between p-4 sm:p-6 md:p-8 pt-8 sm:pt-10 md:pt-12 pb-8 sm:pb-10 md:pb-12">
                    
                    <!-- Top Section -->
                    <div>
                        <div class="text-xs uppercase tracking-[0.3em] text-white/70 mb-2">2026 Niyet Kartƒ±</div>
                        <div class="w-8 h-px bg-white/50 mx-auto"></div>
                    </div>

                    <!-- Center Section -->
                    <div>
                        <h3 class="text-xl sm:text-2xl serif text-white italic mb-2 font-light">Sevgili <span id="card-name" class="font-normal text-amber-200"></span>,</h3>
                        <p class="text-xs text-gray-300 font-light mb-4 sm:mb-6 md:mb-8">Bu yƒ±l senin i√ßin bu kelimenin yƒ±lƒ± olacak:</p>
                        
                        <!-- Main Word -->
                        <h1 id="card-word" class="text-4xl sm:text-5xl md:text-6xl serif font-bold mb-4 drop-shadow-[0_0_15px_rgba(0,0,0,0.8)]" style="line-height: 1.2;"></h1>
                        
                        <div id="card-glow" class="w-32 h-1 bg-amber-500 rounded-full mx-auto shadow-[0_0_20px_rgba(251,191,36,0.8)]"></div>
                    </div>

                    <!-- Bottom Section -->
                    <div>
                        <p class="serif italic text-white/80 text-sm mb-6 leading-relaxed">
                            "Eski y√ºkleri r√ºzgara bƒ±raktƒ±m.<br>Kendi ƒ±≈üƒ±ƒüƒ±mƒ± g√∂ky√ºz√ºne astƒ±m."
                        </p>
                        
                        <div class="flex justify-between items-center border-t border-white/20 pt-4">
                            <div class="text-left">
                                <div class="text-[10px] uppercase tracking-widest text-white/60">Tarih</div>
                                <div class="text-xs font-serif">01.01.2026</div>
                            </div>
                            <div class="text-right">

                                <div class="text-xs font-serif">Umut Fenerim</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-8 flex flex-col gap-4 w-full max-w-xs pb-10">
                <button onclick="downloadCard()" id="download-btn" class="btn-glow w-full bg-white text-black font-bold py-4 rounded-full uppercase tracking-widest text-xs flex items-center justify-center gap-2">
                    <span>üì∏</span> Hikayeni √ñl√ºms√ºzle≈ütir (ƒ∞ndir)
                </button>
                <button onclick="location.reload()" class="text-white/40 hover:text-white text-xs transition">
                    Ba≈üa D√∂n
                </button>
            </div>
        </div>
    </main>

    <footer>
        <div class="text-xs text-white/60">
            ‚ù§Ô∏è by <a href="https://instagram.com/codenthia" target="_blank" rel="noopener noreferrer">Codenthia</a>
        </div>
    </footer>

    <script>
        // --- DATA ---
        let userData = {
            name: "",
            gender: "", // 'female' or 'male'
            burden: "",
            wish: "",
            colorMain: '#fbbf24',
            colorLight: '#fffbeb'
        };

        // --- BACKGROUND SVG GENERATORS ---
        function createFemaleFlowerSVG() {
            return `
                <svg width="320" height="568" viewBox="0 0 320 568" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="flowerGrad1" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#4a044e;stop-opacity:0.8" />
                            <stop offset="100%" style="stop-color:#1a1a2e;stop-opacity:0.6" />
                        </linearGradient>
                        <linearGradient id="flowerGrad2" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#6b2c91;stop-opacity:0.7" />
                            <stop offset="100%" style="stop-color:#2d1b3d;stop-opacity:0.5" />
                        </linearGradient>
                        <radialGradient id="petalGrad">
                            <stop offset="0%" style="stop-color:#8b5a9f;stop-opacity:0.6" />
                            <stop offset="100%" style="stop-color:#3d2a4d;stop-opacity:0.3" />
                        </radialGradient>
                    </defs>
                    <rect width="320" height="568" fill="url(#flowerGrad1)"/>
                    
                    <!-- Ana √ái√ßek - Merkez -->
                    <g transform="translate(160, 200)">
                        <!-- Yapraklar -->
                        <ellipse cx="0" cy="0" rx="45" ry="25" fill="url(#petalGrad)" transform="rotate(0)"/>
                        <ellipse cx="0" cy="0" rx="45" ry="25" fill="url(#petalGrad)" transform="rotate(45)"/>
                        <ellipse cx="0" cy="0" rx="45" ry="25" fill="url(#petalGrad)" transform="rotate(90)"/>
                        <ellipse cx="0" cy="0" rx="45" ry="25" fill="url(#petalGrad)" transform="rotate(135)"/>
                        <ellipse cx="0" cy="0" rx="45" ry="25" fill="url(#petalGrad)" transform="rotate(180)"/>
                        <ellipse cx="0" cy="0" rx="45" ry="25" fill="url(#petalGrad)" transform="rotate(225)"/>
                        <ellipse cx="0" cy="0" rx="45" ry="25" fill="url(#petalGrad)" transform="rotate(270)"/>
                        <ellipse cx="0" cy="0" rx="45" ry="25" fill="url(#petalGrad)" transform="rotate(315)"/>
                        <!-- Merkez -->
                        <circle cx="0" cy="0" r="15" fill="#6b2c91" opacity="0.7"/>
                    </g>
                    
                    <!-- Sol √úst √ái√ßek -->
                    <g transform="translate(80, 120)">
                        <ellipse cx="0" cy="0" rx="30" ry="18" fill="url(#petalGrad)" transform="rotate(20)"/>
                        <ellipse cx="0" cy="0" rx="30" ry="18" fill="url(#petalGrad)" transform="rotate(65)"/>
                        <ellipse cx="0" cy="0" rx="30" ry="18" fill="url(#petalGrad)" transform="rotate(110)"/>
                        <ellipse cx="0" cy="0" rx="30" ry="18" fill="url(#petalGrad)" transform="rotate(155)"/>
                        <circle cx="0" cy="0" r="10" fill="#7b4a8f" opacity="0.6"/>
                    </g>
                    
                    <!-- Saƒü Alt √ái√ßek -->
                    <g transform="translate(240, 400)">
                        <ellipse cx="0" cy="0" rx="35" ry="20" fill="url(#petalGrad)" transform="rotate(10)"/>
                        <ellipse cx="0" cy="0" rx="35" ry="20" fill="url(#petalGrad)" transform="rotate(55)"/>
                        <ellipse cx="0" cy="0" rx="35" ry="20" fill="url(#petalGrad)" transform="rotate(100)"/>
                        <ellipse cx="0" cy="0" rx="35" ry="20" fill="url(#petalGrad)" transform="rotate(145)"/>
                        <circle cx="0" cy="0" r="12" fill="#6b2c91" opacity="0.6"/>
                    </g>
                    
                    <!-- Dekoratif Yapraklar -->
                    <path d="M 50 300 Q 30 280, 40 260 Q 50 250, 60 270 Q 70 290, 50 300" fill="#4a044e" opacity="0.4"/>
                    <path d="M 270 250 Q 290 230, 280 210 Q 270 200, 260 220 Q 250 240, 270 250" fill="#6b2c91" opacity="0.4"/>
                    <path d="M 100 450 Q 120 430, 110 410 Q 100 400, 90 420 Q 80 440, 100 450" fill="#5a1a6e" opacity="0.4"/>
                </svg>
            `;
        }

        function createMaleAbstractSVG() {
            return `
                <svg width="320" height="568" viewBox="0 0 320 568" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="maleGrad1" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#0f172a;stop-opacity:1" />
                            <stop offset="50%" style="stop-color:#1e293b;stop-opacity:0.9" />
                            <stop offset="100%" style="stop-color:#020617;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="maleGrad2" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#1e3a8a;stop-opacity:0.6" />
                            <stop offset="100%" style="stop-color:#0c4a6e;stop-opacity:0.4" />
                        </linearGradient>
                        <radialGradient id="glowGrad" cx="50%" cy="50%">
                            <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:0.5" />
                            <stop offset="100%" style="stop-color:#1e40af;stop-opacity:0" />
                        </radialGradient>
                    </defs>
                    <rect width="320" height="568" fill="url(#maleGrad1)"/>
                    
                    <!-- Geometrik ≈ûekiller -->
                    <!-- B√ºy√ºk √ú√ßgen -->
                    <polygon points="160,100 80,250 240,250" fill="url(#maleGrad2)" opacity="0.3"/>
                    <polygon points="160,120 100,240 220,240" fill="url(#maleGrad2)" opacity="0.2"/>
                    
                    <!-- Merkez Daire -->
                    <circle cx="160" cy="280" r="60" fill="url(#glowGrad)"/>
                    <circle cx="160" cy="280" r="40" fill="#1e3a8a" opacity="0.4"/>
                    <circle cx="160" cy="280" r="20" fill="#3b82f6" opacity="0.6"/>
                    
                    <!-- Sol Alt Geometrik ≈ûekil -->
                    <polygon points="40,400 20,500 100,480 80,420" fill="#1e40af" opacity="0.25"/>
                    <polygon points="50,410 30,490 90,475 75,430" fill="#3b82f6" opacity="0.2"/>
                    
                    <!-- Saƒü √úst Geometrik ≈ûekil -->
                    <polygon points="280,150 300,80 240,100 260,160" fill="#0c4a6e" opacity="0.25"/>
                    <polygon points="270,140 290,90 250,105 265,150" fill="#1e3a8a" opacity="0.2"/>
                    
                    <!-- Alt Merkez ≈ûekil -->
                    <polygon points="160,450 120,520 200,520" fill="url(#maleGrad2)" opacity="0.2"/>
                    <polygon points="160,460 130,510 190,510" fill="#1e40af" opacity="0.15"/>
                    
                    <!-- Dekoratif √áizgiler -->
                    <line x1="0" y1="200" x2="320" y2="200" stroke="#3b82f6" stroke-width="1" opacity="0.1"/>
                    <line x1="0" y1="360" x2="320" y2="360" stroke="#1e40af" stroke-width="1" opacity="0.1"/>
                    <line x1="160" y1="0" x2="160" y2="568" stroke="#0c4a6e" stroke-width="1" opacity="0.08"/>
                    
                    <!-- I≈üƒ±k Efektleri -->
                    <ellipse cx="160" cy="150" rx="80" ry="30" fill="#3b82f6" opacity="0.15"/>
                    <ellipse cx="100" cy="400" rx="50" ry="40" fill="#1e40af" opacity="0.12"/>
                    <ellipse cx="220" cy="450" rx="60" ry="35" fill="#0c4a6e" opacity="0.1"/>
                </svg>
            `;
        }

        // --- AUDIO ---
        const audio = document.getElementById('bg-music');
        const sfxBurst = document.getElementById('sfx-burst');
        const sfxChime = document.getElementById('sfx-chime');
        const musicBtn = document.getElementById('music-control');
        let musicStarted = false;

        function forcePlayMusic() {
            if (audio.paused) {
                // √ñnce muted ile ba≈ülatmayƒ± dene (tarayƒ±cƒ±lar genelde buna izin verir)
                if (audio.muted) {
                    audio.muted = false;
                }
                audio.volume = 0.5;
                const playPromise = audio.play();
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        musicBtn.classList.remove('paused');
                        musicStarted = true;
                    }).catch(e => {
                        console.log('M√ºzik ba≈ülatƒ±lamadƒ±:', e);
                    });
                }
            } else {
                audio.pause();
                musicBtn.classList.add('paused');
            }
        }

        // M√ºziƒüi ba≈ülatmayƒ± deneyen yardƒ±mcƒ± fonksiyon
        function tryStartMusic() {
            if (!musicStarted && audio.paused) {
                forcePlayMusic();
            }
        }

        // --- FLOW LOGIC ---
        function submitName() {
            const input = document.getElementById('input-name');
            if(!input.value.trim()) { input.placeholder = "L√ºtfen adƒ±nƒ± yaz..."; return; }
            userData.name = input.value.trim();
            
            // M√ºzik ba≈ülatma denemesi (Kullanƒ±cƒ± etkile≈üimi)
            if(!musicStarted) forcePlayMusic();

            nextStep('step-0', 'step-gender');
        }

        function selectGender(gender) {
            userData.gender = gender;
            nextStep('step-gender', 'step-1');
        }

        function releaseBurden() {
            const input = document.getElementById('input-burden');
            if(!input.value.trim()) { input.placeholder = "Bir ≈üeyler yaz..."; return; }
            userData.burden = input.value;
            
            sfxBurst.volume=0.6; sfxBurst.currentTime=0; sfxBurst.play().catch(()=>{});
            explodeText(); 
            input.value=""; input.style.opacity="0";
            
            setTimeout(() => { nextStep('step-1', 'step-2'); }, 800);
        }

        function selectColor(el, mainColor, lightColor) {
            document.querySelectorAll('.color-dot').forEach(d => d.classList.remove('selected'));
            el.classList.add('selected');
            userData.colorMain = mainColor;
            userData.colorLight = lightColor;
            document.getElementById('input-wish').style.color = mainColor;
        }

        function launchLantern() {
            const input = document.getElementById('input-wish');
            if(!input.value.trim()) { input.placeholder = "Dileƒüini yaz..."; return; }
            userData.wish = input.value;

            sfxChime.volume=0.8; sfxChime.currentTime=0; sfxChime.play().catch(()=>{});
            const flash = document.getElementById('flash-overlay'); flash.classList.add('flash-active');
            setTimeout(()=>{flash.classList.remove('flash-active');},100);
            
            lanterns.push(new Lantern(true));
            nextStep('step-2', 'step-3');
            
            document.getElementById('display-wish').innerText = userData.wish;
            document.getElementById('display-wish').style.color = userData.colorMain;
        }

        function triggerCompletion() {
            const statusText = document.getElementById('status-text');
            statusText.style.opacity = '0';
            setTimeout(() => {
                statusText.innerText = "Evren niyetini kabul etti...";
                statusText.style.opacity = '1';
                statusText.style.color = '#fff';
                statusText.style.textShadow = "0 0 10px rgba(255,255,255,0.5)";
                document.getElementById('finish-btn').style.opacity = '1';
            }, 1000);
        }

        function showFinalCard() {
            nextStep('step-3', 'step-4');
            
            // KART DETAYLARINI DOLDUR
            document.getElementById('card-name').innerText = userData.name;
            document.getElementById('card-word').innerText = userData.wish.toUpperCase();
            document.getElementById('card-word').style.color = userData.colorMain;
            document.getElementById('card-glow').style.backgroundColor = userData.colorMain;

            // BACKGROUND SVG SE√áƒ∞Mƒ∞
            const bgSvg = document.getElementById('card-bg-svg');
            if(userData.gender === 'female') {
                bgSvg.innerHTML = createFemaleFlowerSVG();
            } else {
                bgSvg.innerHTML = createMaleAbstractSVG();
            }
        }

        function nextStep(currentId, nextId) {
            document.getElementById(currentId).classList.add('hidden');
            const nextEl = document.getElementById(nextId);
            nextEl.classList.remove('hidden');
            nextEl.classList.add('fade-in');
        }

        // --- DOWNLOAD LOGIC ---
        function downloadCard() {
            const btn = document.getElementById('download-btn');
            const originalText = btn.innerHTML;
            btn.innerHTML = "‚è≥ Hazƒ±rlanƒ±yor...";

            const element = document.getElementById("capture-area");

            html2canvas(element, {
                backgroundColor: null,
                scale: 2,
                logging: false,
                useCORS: true, // √ñnemli: Dƒ±≈ü resimleri y√ºklemek i√ßin
                allowTaint: true
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = `lumina-2026-${userData.name}.png`;
                link.href = canvas.toDataURL("image/png");
                link.click();
                btn.innerHTML = "‚úÖ ƒ∞ndirildi!";
                setTimeout(() => { btn.innerHTML = originalText; }, 2000);
            }).catch(err => {
                console.error(err);
                btn.innerHTML = "‚ùå Hata Oldu";
            });
        }

        // --- VISUALS (Previous Logic) ---
        const pCanvas = document.getElementById('particles-canvas');
        const pCtx = pCanvas.getContext('2d');
        const lCanvas = document.getElementById('lanterns-canvas');
        const lCtx = lCanvas.getContext('2d');
        const sCanvas = document.getElementById('sky-canvas');
        const sCtx = sCanvas.getContext('2d');
        let particles = [], lanterns = [], trailParticles = [], stars = [], shootingStars = [];
        let mainLanternGone = false;

        function resizeCanvas() { [pCanvas, lCanvas, sCanvas].forEach(c => { c.width = window.innerWidth; c.height = window.innerHeight; }); initStars(); }
        class Star { constructor(){this.x=Math.random()*sCanvas.width;this.y=Math.random()*sCanvas.height;this.size=Math.random()*1.5;this.blinkSpeed=Math.random()*0.05+0.01;this.alpha=Math.random()} draw(){this.alpha+=this.blinkSpeed;sCtx.fillStyle=`rgba(255,255,255,${(Math.sin(this.alpha)+1)/2*0.8})`;sCtx.beginPath();sCtx.arc(this.x,this.y,this.size,0,Math.PI*2);sCtx.fill()}}
        class ShootingStar { constructor(){this.reset()} reset(){this.x=Math.random()*sCanvas.width;this.y=Math.random()*sCanvas.height/2;this.len=Math.random()*80+10;this.speed=Math.random()*10+6;this.size=Math.random()*1+0.1;this.waitTime=Math.random()*1000;this.active=false} update(){if(this.active){this.x-=this.speed;this.y+=this.speed/2;if(this.x<0||this.y>sCanvas.height){this.active=false;this.waitTime=Math.random()*500+200}}else{this.waitTime--;if(this.waitTime<=0){this.reset();this.active=true}}} draw(){if(!this.active)return;sCtx.strokeStyle='rgba(255,255,255,0.6)';sCtx.lineWidth=this.size;sCtx.beginPath();sCtx.moveTo(this.x,this.y);sCtx.lineTo(this.x+this.len,this.y-this.len/2);sCtx.stroke()}}
        function initStars(){stars=[];for(let i=0;i<150;i++)stars.push(new Star());shootingStars=[new ShootingStar()]}
        function animateSky(){sCtx.clearRect(0,0,sCanvas.width,sCanvas.height);stars.forEach(s=>s.draw());shootingStars.forEach(s=>{s.update();s.draw()});requestAnimationFrame(animateSky)}

        class TextParticle { constructor(x,y){this.x=x;this.y=y;this.size=Math.random()*3+1;this.speedX=(Math.random()-0.5)*10;this.speedY=(Math.random()-0.5)*10;this.life=100;this.color=`rgba(255,255,255,${Math.random()})`} update(){this.x+=this.speedX;this.y+=this.speedY;this.life-=2;this.size*=0.95} draw(){pCtx.fillStyle=this.color;pCtx.beginPath();pCtx.arc(this.x,this.y,this.size,0,Math.PI*2);pCtx.fill()}}
        function explodeText(){const rect=document.getElementById('input-burden').getBoundingClientRect();for(let i=0;i<100;i++)particles.push(new TextParticle(rect.left+rect.width/2,rect.top+rect.height/2));animateParticles()}
        function animateParticles(){if(particles.length===0)return;pCtx.clearRect(0,0,pCanvas.width,pCanvas.height);particles.forEach((p,i)=>{p.update();p.draw();if(p.life<=0)particles.splice(i,1)});requestAnimationFrame(animateParticles)}

        class Trail{constructor(x,y,color){this.x=x;this.y=y;this.alpha=1;this.size=Math.random()*3;this.drift=(Math.random()-0.5)*0.5;this.color=color||'#fbbf24'}update(){this.y+=0.5;this.x+=this.drift;this.alpha-=0.02}draw(){lCtx.save();lCtx.globalAlpha=this.alpha;lCtx.fillStyle=this.color;lCtx.beginPath();lCtx.arc(this.x,this.y,this.size,0,Math.PI*2);lCtx.fill();lCtx.restore()}}
        
        class Lantern {
            constructor(isMain=false){
                this.x=Math.random()*lCanvas.width;this.y=lCanvas.height+Math.random()*200;this.isMain=isMain;
                if(isMain){this.x=lCanvas.width/2;this.y=lCanvas.height+150;this.size=60;this.speed=0;this.acceleration=0.015;this.maxSpeed=2;this.wobbleSpeed=0.01;this.mainColor=userData.colorMain;this.lightColor=userData.colorLight;}
                else{this.size=Math.random()*8+3;this.speed=Math.random()*0.6+0.2;this.wobbleSpeed=0.03;const hue=Math.floor(Math.random()*40)+10;this.bgFill=`hsla(${hue},100%,60%,0.7)`;}
                this.wobble=Math.random()*Math.PI*2;
            }
            update(){
                if(this.isMain){
                    if(this.speed<this.maxSpeed)this.speed+=this.acceleration;this.y-=this.speed;
                    if(Math.random()>0.5)trailParticles.push(new Trail(this.x,this.y+this.size*1.2,this.mainColor));
                    if(this.y<-200&&!mainLanternGone){mainLanternGone=true;triggerCompletion();}
                }else{this.y-=this.speed}
                this.x+=Math.sin(this.wobble)*0.5;this.wobble+=this.wobbleSpeed;
                if(!this.isMain&&this.y<-100){this.y=lCanvas.height+50;this.x=Math.random()*lCanvas.width}
            }
            draw(){
                lCtx.save();
                if(this.isMain){
                    const pulse=Math.sin(Date.now()/200)*10;lCtx.shadowBlur=50+pulse;lCtx.shadowColor=this.mainColor;
                    const grad=lCtx.createLinearGradient(this.x,this.y+this.size*1.3,this.x,this.y);grad.addColorStop(0,this.lightColor);grad.addColorStop(0.4,this.mainColor);grad.addColorStop(1,'#92400e');
                    lCtx.fillStyle=grad;lCtx.beginPath();lCtx.arc(this.x,this.y,this.size*0.6,Math.PI,0);lCtx.lineTo(this.x+this.size*0.5,this.y+this.size*1.3);lCtx.lineTo(this.x-this.size*0.5,this.y+this.size*1.3);lCtx.closePath();lCtx.fill();
                    lCtx.shadowBlur=0;lCtx.beginPath();lCtx.ellipse(this.x,this.y+this.size*1.3,this.size*0.5,this.size*0.1,0,0,Math.PI*2);lCtx.lineWidth=2;lCtx.strokeStyle='rgba(255,255,255,0.3)';lCtx.stroke();
                    lCtx.fillStyle='#fff';lCtx.shadowBlur=20;lCtx.shadowColor='#fff';lCtx.beginPath();lCtx.arc(this.x,this.y+this.size*1.25,this.size*0.15,0,Math.PI*2);lCtx.fill();
                }else{
                    lCtx.shadowBlur=10;lCtx.shadowColor=this.bgFill;lCtx.fillStyle=this.bgFill;lCtx.fillRect(this.x-this.size/2,this.y,this.size,this.size*1.4);
                    lCtx.fillStyle='rgba(255,255,255,0.4)';lCtx.fillRect(this.x-this.size/4,this.y+this.size/2,this.size/2,this.size/2);
                }
                lCtx.restore();
            }
        }
        function initBackgroundLanterns(){for(let i=0;i<50;i++)lanterns.push(new Lantern(false));animateLanterns()}
        function animateLanterns(){
            lCtx.clearRect(0,0,lCanvas.width,lCanvas.height);
            lanterns.forEach(l=>{if(!l.isMain){l.update();l.draw()}});
            trailParticles.forEach((p,i)=>{p.update();p.draw();if(p.alpha<=0)trailParticles.splice(i,1)});
            lanterns.forEach(l=>{if(l.isMain){l.update();l.draw()}});
            requestAnimationFrame(animateLanterns);
        }

        resizeCanvas(); window.addEventListener('resize', resizeCanvas);
        initBackgroundLanterns(); initStars(); animateSky();

        // Sayfa y√ºklendiƒüinde m√ºziƒüi otomatik ba≈ülatmayƒ± dene
        function initMusic() {
            // Muted'ƒ± kaldƒ±r (autoplay i√ßin muted ile ba≈üladƒ±k)
            audio.muted = false;
            
            // Hemen dene
            tryStartMusic();
            
            // Kƒ±sa bir gecikme ile tekrar dene
            setTimeout(() => tryStartMusic(), 300);
            setTimeout(() => tryStartMusic(), 1000);
        }

        // Sayfa y√ºklendiƒüinde √ßalƒ±≈ütƒ±r
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initMusic);
        } else {
            initMusic();
        }

        // Her t√ºrl√º kullanƒ±cƒ± etkile≈üiminde m√ºziƒüi ba≈ülatmayƒ± dene
        const interactionEvents = ['click', 'touchstart', 'mousedown', 'keydown', 'mousemove', 'touchmove'];
        interactionEvents.forEach(eventType => {
            document.addEventListener(eventType, () => {
                tryStartMusic();
            }, { once: true, passive: true });
        });
    </script>
</body>
</html>